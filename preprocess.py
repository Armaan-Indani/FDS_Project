import pandas as pd
import re
from collections import Counter

# Load data
courses_df = pd.read_csv("app/data/1_courses.csv")
jobs_df = pd.read_csv("app/data/2_jobs.csv")

courses_df['skills'] = courses_df['skills'].fillna('')
jobs_df['skills'] = jobs_df['skills'].fillna('')

# Use full skill_list here (shortened for example)
# skill_list = ['python', 'sql', 'excel', 'machine learning', 'data science', 'cloud', 'java', 'react', 'project management', 'linux']
skill_list = ['cloud', 'social media', 'html', 'css', 'javascript', 'react', 'angular', 'network security', 'java', 'python', 'sql', 'nosql', 'django', 'swift', 'jira', 'salesforce', 'power bi', 'tableau', 'azure', 'docker', 'kubernetes', 'sas', 'postgresql', 'linux', 'cloud computing', 'ibm cloud', 'machine learning', 'deep learning', 'neural networks', 'natural language processing', 'computer vision', 'reinforcement learning', 'data science', 'big data', 'data mining', 'data visualization', 'r programming', 'matlab', 'statistics', 'project management', 'agile', 'scrum', 'risk management', 'change management', 'devops', 'continuous integration', 'business analysis', 'business intelligence', 'strategy', 'marketing', 'finance', 'operations management', 'supply chain', 'leadership', 'negotiation', 'communication', 'problem solving', 'critical thinking', 'adaptability', 'creativity', 'emotional intelligence', 'data structures', 'algorithms', 'networking', 'network architecture', 'blockchain', 'internet of things', 'virtual reality', 'feature engineering', 'continuous delivery', 'c', 'data engineering', 'data warehousing', 'product management', 'market research', 'digital marketing', 'brand management', 'decision making', 'user research', 'looker', 'fintech', 'api', 'bi', 'networking hardware', 'accounting software', 'technical product management', 'web frameworks', 'computer security', 'incident management', 'forecasting', 'programming principles', 'shipping and receiving', 'computer networking', 'excel', 'financial management', 'software security', 'corporate accouting', 'business research', 'data analysis software', 'software architecture', 'cryptography', 'customer support', 'machine learning algorithms', 'media strategy & planning', 'computer security models', 'cyberattacks', 'securities trading', 'collaboration', 'theoretical computer science', 'graph theory', 'storytelling', 'security engineering', 'arcgis', 'software engineering', 'database application', 'exploratory data analysis', 'database theory', 'differential equations', 'microsoft azure', 'google app engine', 'scala programming', 'influencing', 'gis software', 'c++ programming', 'cloud-based integration', 'linear algebra', 'software-defined networking', 'c programming language family', 'software engineering tools', 'supply chain and logistics', 'basic descriptive statistics', 'java programming', 'advertising sales', 'computer programming tools', 'python programming', 'people analysis', 'product marketing', 'resilience', 'software visualization', 'combinatorics', 'data management', 'search engine optimization', 'performance management', 'other programming languages', 'probability & statistics', 'information technology', 'transportation operations management', 'other cloud platforms and tools', 'html and css', 'cloud infrastructure', 'talent management', 'entrepreneurship', 'market analysis', 'management accounting', 'human resources', 'computer architecture', 'game theory', 'tensorflow', 'mobile development tools', 'geometry', 'apache', 'recruitment', 'business design', 'data architecture', 'cloud management', 'product lifecycle', 'probability distribution', 'customer success', 'accounting', 'semantic web', 'supply chain systems', 'cloud engineering', 'tableau software', 'customer relationship management', 'organizational development', 'spatial analysis', 'human resources operations', 'knitr', 'geovisualization', 'system software', 'security strategy', 'mathematical theory & analysis', 'database administration', 'back-end web development', 'application development', 'bayesian network', 'process analysis', 'mergers & acquisitions', 'artificial neural networks', 'statistical analysis', 'survey creation', 'markov model', 'culture', 'small data', 'hardware design', 'regression', 'correlation and dependence', 'operations research', 'cloud load balancing', 'cloud api', 'design and product', 'journalism', 'financial analysis', 'computer graphics', 'planning', 'human learning', 'cash management', 'human computer interaction', 'computer graphic techniques', 'system security', 'procurement', 'general accounting', 'full-stack web development', 'graphic design', 'data analysis', 'people development', 'cloud clients', 'mathematics', 'inventory management', 'business development', 'cloud applications', 'entrepreneurial finance', 'web development tools', 'front-end web development', 'taxes', 'merchandising', 'software as a service', 'statistical tests', 'bioinformatics', 'b2b sales', 'budget management', 'contract management', 'computer science', 'marketing psychology', 'material handling', 'cloud standards', 'computational thinking', 'professional development', 'visual design', 'payments', 'security software', 'algebra', 'writing', 'product development', 'benefits', 'web design', 'persona research', 'marketing management', 'conflict management', 'computer programming', 'sales', 'databases', 'strategy and operations', 'employee relations', 'agile software development', 'public relations', 'database design', 'hr tech', 'business transformation', 'audit', 'banking', 'research and design', 'media production', 'data model', 'devops tools', 'cross platform development', 'mobile development', 'business communication', 'scientific visualization', 'behavioral economics', 'experiment', 'network analysis', 'dimensionality reduction', 'training', 'cloud platforms', 'cost accounting', 'e-commerce', 'innovation', 'financial accounting', 'marketing design', 'accounts payable and receivable', 'google cloud platform', 'graphics software', 'ios development', 'securities sales', 'interactive data visualization', 'spreadsheet software', 'retail store operations', 'product strategy', 'machine learning software', 'prospecting and qualification', 'clinical data management', 'epidemiology', 'calculus', 'interactive design', 'billing & invoicing', 'supplier relationship management', 'operational analysis', 'inside sales', 'microarchitecture', 'statistical machine learning', 'business process management', 'user experience design', 'operating systems', 'applied machine learning', 'advertising', 'user experience', 'spatial data analysis', 'android development', 'regulations and compliance', 'systems design', 'applied mathematics', 'statistical visualization', 'econometrics', 'investment management', 'computational logic', 'mobile security', 'leadership development', 'leadership and management', 'product design', 'warehouse management', 'biostatistics', 'business psychology', 'system programming', 'distributed computing architecture', 'swift programming', 'compensation', 'network model', 'estimation', 'cloud storage', 'general statistics', 'customer analysis', 'people management', 'software testing', 'geostatistics', 'bayesian statistics', 'statistical programming', 'retail sales', 'account management', 'amazon web services', 'web development', 'data visualization software', 'sales systems', 'insurance sales']


def parse_skills(skills_str):
    return [skill for skill in skill_list if re.search(r'\b' + re.escape(skill) + r'\b', skills_str.lower())]

# Precompute skills_list
courses_df['skills_list'] = courses_df['skills'].apply(parse_skills)
jobs_df['skills_list'] = jobs_df['skills'].apply(parse_skills)

# Save to new CSVs (or overwrite originals if you prefer)
courses_df.to_csv("app/data/courses_preprocessed.csv", index=False)
jobs_df.to_csv("app/data/jobs_preprocessed.csv", index=False)

print("Preprocessing done. Files saved.")
